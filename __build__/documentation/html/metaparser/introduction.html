

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; Genie Documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/asciinema-player.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/genie_ico.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/asciinema-player.js"></script>
        <script src="../_static/tracker.js"></script>
        <script src="../_static/embed_version.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced" href="advanced/index.html" />
    <link rel="prev" title="Metaparsers" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pyATS Library: Genie
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbooks/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userguide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clean/index.html">pyATS Clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../health/index.html">pyATS Health Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Genie Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../solutions/index.html">Genie Solutions</a></li>
</ul>
<p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">Available APIs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/clean">Available Clean Stages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/models">Available Models (Conf/Ops)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">Available Parsers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/triggers">Available Triggers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/verifications">Available Verifications</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Docs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../abstract/index.html">Library Abstraction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Metaparsers</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced/index.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/index.html">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../parsergen/index.html">CLI Auto-Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../predcore/index.html">Predicates</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyATS Library: Genie</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Metaparsers</a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>In software engineering and computer science, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Parsing</span></code> is the mecahnism of
translating incomprehensible data to a script readable form. Parsers are the
root of automation, without them, automation could not
understand the device. There exists multiple ways to parse the device output,
with <code class="xref py py-obj docutils literal notranslate"><span class="pre">different</span> <span class="pre">packages</span></code> with each their style.
There also exist multiple ways to communicate with the device (Cli, Xml, Rest,
Yang, etc.) with each providing <code class="xref py py-obj docutils literal notranslate"><span class="pre">different</span> <span class="pre">structure</span></code> for the same information!</p>
<p>Metaparser role is to unify those packages, into one <code class="xref py py-obj docutils literal notranslate"><span class="pre">location</span></code> and one
<code class="xref py py-obj docutils literal notranslate"><span class="pre">structure</span></code>. A unified collection of parser, which works across multiple parser
packages, and across multiple communication protocols and still returns a
common structure. Metaparser allows to have one <code class="xref py py-obj docutils literal notranslate"><span class="pre">script</span></code> which works across
multiple OS, multiple communication protocol and parsing packages.</p>
<p>Imagine an parsing infrastructure that:</p>
<ul class="simple">
<li><p>Promotes more easily maintainable platform/type/version agnostic testing
scripts by deferring operational data parsing to back-end libraries,</p></li>
<li><p>Harmonizes parsing output among various interface categories, such as CLI,
XML and YANG</p></li>
<li><p>Enforces only enough structure to give the script writer a consistent look
and feel across interface categories</p></li>
<li><p>Is future proof, allowing a multitude of existing and yet-to-be-imagined
parsing implementations to coexist in the backend</p></li>
<li><p>Enables an elastic parsing ecosystem that is simple enough for the novice but
feature-rich enough for the power user</p></li>
<li><p>Leverages the strength of the modern Python-3 language while still allowing
bridging/reuse of Cisco’s vast store of legacy TCL-based parsers.</p></li>
</ul>
<div class="figure align-center">
<img alt="../_images/structure1.png" src="../_images/structure1.png" />
</div>
</div>
<div class="section" id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h1>
<div class="figure align-center">
<img alt="../_images/Metaparser.png" src="../_images/Metaparser.png" />
</div>
<p>First, Import <code class="docutils literal notranslate"><span class="pre">Metaparser</span></code> as illustrated in the below example so it can be
used for inheritance for different schema classes. Metaparser schemaengine
provides various functionalities for the use within the schema structure as
explained in details here <a href="#id1"><span class="problematic" id="id2">:schemaengine:`schema engine documentation &lt;http&gt;`</span></a>.</p>
<div class="sidebar">
<p class="sidebar-title">Helpful Reading</p>
<ul class="simple">
<li><p><a class="reference external" href="http://docs.python.org/3/tutorial/classes.html">Class Tutorial</a></p></li>
<li><p><a class="reference external" href="http://docs.python.org/2/tutorial/classes.html?highlight=inheritance">Inheritance Tutorial</a></p></li>
</ul>
</div>
<p>In the below example, we are building a parser for three different show commands
using different contexts CLI, Yang and XML. The contexts’ implementations are
following the same schema/structure so making the parser more rigid to any
change which will consequently provide stable/strong test scripts. Different
parsing mechanisms (Regex, <a class="reference internal" href="../parsergen/index.html#parsergen"><span class="std std-ref">parsergen</span></a>, TextFSM, etc.) can be used withing the
parser as shown below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Below example is not a complete one and it was just used for
illustration purpose.</p>
<p>Tons of parsers are already built and can be reached in <a class="reference external" href="http://wwwin-pyats.cisco.com/cisco-shared/genie/latest/genie_libs/#/parsers">parsers</a>;</p>
<p>Can’t find a parser and want to build one?
Visit <a class="reference internal" href="advanced/contribute.html#contribute-to-parser-build"><span class="std std-ref">Contribute in parsers build</span></a> section for detailed_steps.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Example</span> <span class="mi">1</span>
<span class="o">---------</span>
<span class="c1"># Metaparser</span>
<span class="kn">from</span> <span class="nn">genie.metaparser</span> <span class="kn">import</span> <span class="n">MetaParser</span>
<span class="kn">from</span> <span class="nn">genie.metaparser.util.schemaengine</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># Schema for:</span>
<span class="c1"># * &#39;show bgp vrf &lt;vrf&gt; &lt;address_family&gt;  policy statistics redistribute</span>
<span class="c1"># * &#39;show bgp vrf &lt;vrf&gt; &lt;address_family&gt;  policy statistics dampening&#39;</span>
<span class="c1"># * &#39;show bgp vrf &lt;vrf&gt; &lt;address_family&gt;  policy statistics neighbor &lt;neighbor&gt;&#39;</span>
<span class="c1"># ==============================================================================</span>
<span class="k">class</span> <span class="nc">ShowBgpPolicyStatisticsSchema</span><span class="p">(</span><span class="n">MetaParser</span><span class="p">):</span>

    <span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">Any</span><span class="p">():</span> <span class="p">{</span>
                <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;rpm_handle_count&#39;</span><span class="p">):</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;route_map&#39;</span><span class="p">):</span> <span class="p">{</span>
                    <span class="n">Any</span><span class="p">():{</span>
                        <span class="n">Any</span><span class="p">():</span> <span class="p">{</span>
                            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="s1">&#39;seq_num&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="s1">&#39;total_accept_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="s1">&#39;total_reject_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">):</span> <span class="p">{</span>
                                <span class="s1">&#39;compare_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="s1">&#39;match_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="nb">str</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">ShowBgpPolicyStatistics</span><span class="p">(</span><span class="n">ShowBgpPolicyStatisticsSchema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for:</span>
<span class="sd">        show bgp [vrf &lt;vrf&gt;] &lt;address_family&gt;  policy statistics redistribute</span>
<span class="sd">        show bgp [vrf &lt;vrf&gt;] &lt;address_family&gt;  policy statistics dampening</span>
<span class="sd">        show bgp [vrf &lt;vrf&gt;] &lt;address_family&gt;  policy statistics neighbor &lt;neighbor&gt;</span>
<span class="sd">        parser class implements detail parsing mechanisms for cli,xml</span>
<span class="sd">        and yang output&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># Init vars</span>
        <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># extract vrf info if specified,</span>
        <span class="c1"># if not, vrf is default</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^show +bgp +vrf +(?P&lt;vrf&gt;\S+)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">vrf</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;vrf&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vrf</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">vrf</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vrf</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Details for VRF default</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Details +for +VRF +&#39;</span>
                             <span class="s1">&#39;(?P&lt;vrf&gt;[\w\-]+)$&#39;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">vrf</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;vrf&#39;</span><span class="p">]</span>
                <span class="n">nei_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="c1"># No such neighbor</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;No +such +neighbor$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">nei_flag</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Total count for redistribute rpm handles: 1</span>
            <span class="c1"># Total count for neighbor rpm handles: 1</span>
            <span class="c1"># Total count for dampening rpm handles: 1</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Total +count +for +(?P&lt;type&gt;\w+) +rpm +handles: +&#39;</span>
                             <span class="s1">&#39;(?P&lt;handles&gt;\d+)$&#39;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="c1"># BGP policy statistics not available</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^BGP +policy +statistics +not +available$&#39;</span><span class="p">)</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">p3</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">m1</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;vrf&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ret_dict</span><span class="p">:</span>
                    <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;vrf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="n">vrf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;vrf&#39;</span><span class="p">]:</span>
                    <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;vrf&#39;</span><span class="p">][</span><span class="n">vrf</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;vrf&#39;</span><span class="p">][</span><span class="n">vrf</span><span class="p">][</span><span class="s1">&#39;rpm_handle_count&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;handles&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">m</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="k">continue</span>

            <span class="c1"># C: No. of comparisions, M: No. of matches</span>

                <span class="o">.....</span> <span class="n">Parser</span> <span class="n">continued</span> <span class="o">.......</span>

        <span class="k">return</span> <span class="n">ret_dict</span>


    <span class="k">def</span> <span class="nf">xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> | xml&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>

        <span class="n">etree_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">neighbor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Remove junk characters returned by the device</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]]&gt;]]&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># top table root</span>
        <span class="n">show_root</span> <span class="o">=</span> <span class="n">Common</span><span class="o">.</span><span class="n">retrieve_xml_child</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;show&#39;</span><span class="p">)</span>
        <span class="c1"># get xml namespace</span>
        <span class="c1"># {http://www.cisco.com/nxos:7.0.3.I7.1.:bgp}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;name&gt;\{[\S]+\})&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">show_root</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">etree_dict</span>

        <span class="c1"># compare cli command</span>
        <span class="n">Common</span><span class="o">.</span><span class="n">compose_compare_command</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
                                       <span class="n">expect_command</span><span class="o">=</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># get neighbor</span>
        <span class="n">nei</span> <span class="o">=</span> <span class="n">Common</span><span class="o">.</span><span class="n">retrieve_xml_child</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;__XML__PARAM__neighbor-id&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">nei</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nei</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;__XML__value&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                    <span class="n">neighbor</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">continue</span>

                <span class="c1"># cover the senario that __readonly__ may be mssing when</span>
                <span class="c1"># there are values in the output</span>
                <span class="k">if</span> <span class="s1">&#39;__readonly__&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># top table rootl</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Common</span><span class="o">.</span><span class="n">retrieve_xml_child</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;TABLE_vrf&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">etree_dict</span>

        <span class="c1"># -----   loop vrf  -----</span>
        <span class="k">for</span> <span class="n">vrf_tree</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">ROW_vrf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)):</span>
            <span class="c1"># vrf</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vrf</span> <span class="o">=</span> <span class="n">vrf_tree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">vrf-name-polstats&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span><span class="o">.</span><span class="n">text</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">break</span>

                <span class="o">.....</span> <span class="n">Parser</span> <span class="n">continued</span> <span class="o">.......</span>

        <span class="k">return</span> <span class="n">etree_dict</span>

    <span class="k">def</span> <span class="nf">yang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parsing mechanism: yang</span>

<span class="sd">        Function yang() defines the yang type output parsing mechanism which</span>
<span class="sd">        typically contains 3 steps: executing, transforming, returning</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">map_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;native&gt;&lt;interface&gt;&lt;Vlan/&gt;&lt;/interface&gt;&lt;/native&gt;&#39;&#39;&#39;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;subtree&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">native</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">native</span><span class="p">:</span>
                    <span class="n">vlan_id</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">interface_name</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">ip_address</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">ip_mask</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">interface</span><span class="p">:</span>
                        <span class="c1"># Remove the namespace</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">vlan</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="n">vlan</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="c1">#ydk.models.ned_edison.ned.Native.Interface.Vlan.name</span>
                        <span class="c1">#ydk.models.xe_recent_edison.Cisco_IOS_XE_native.Native.Interface.Vlan.name</span>
                        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
                            <span class="n">vlan_id</span> <span class="o">=</span> <span class="n">vlan</span><span class="o">.</span><span class="n">text</span>
                            <span class="n">interface_name</span> <span class="o">=</span> <span class="s1">&#39;Vlan&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vlan_id</span><span class="p">)</span>
                            <span class="k">continue</span>

                <span class="o">.....</span> <span class="n">Parser</span> <span class="n">continued</span> <span class="o">.......</span>

        <span class="c1"># Return to caller</span>
        <span class="k">return</span> <span class="n">map_dict</span>

<span class="n">Example</span> <span class="mi">2</span> <span class="p">(</span><span class="n">Using</span> <span class="n">Parsergen</span> <span class="n">parsing</span> <span class="n">Mechanism</span><span class="p">)</span>
<span class="o">---------------------------------------------</span>
<span class="c1"># Import parsergen package</span>
<span class="kn">import</span> <span class="nn">parsergen</span>

<span class="c1"># Build Schema</span>
<span class="k">class</span> <span class="nc">ShowIpInterfaceBriefSchema</span><span class="p">(</span><span class="n">MetaParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for show ip interface brief&quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;interface&#39;</span><span class="p">:</span>
                <span class="p">{</span><span class="n">Any</span><span class="p">():</span>
                    <span class="p">{</span><span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;vlan_id&#39;</span><span class="p">):</span>
                        <span class="p">{</span><span class="n">Optional</span><span class="p">(</span><span class="n">Any</span><span class="p">()):</span>
                                <span class="p">{</span><span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;interface_is_ok&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">}</span>
                        <span class="p">},</span>
                     <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;interface_is_ok&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">):</span> <span class="nb">str</span><span class="p">}</span>
                <span class="p">},</span>
            <span class="p">}</span>

<span class="c1"># Build Parser</span>
<span class="k">class</span> <span class="nc">ShowIpInterfaceBrief</span><span class="p">(</span><span class="n">ShowIpInterfaceBriefSchema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for:</span>
<span class="sd">     show ip interface brief</span>
<span class="sd">     parser class implements detail parsing mechanisms for cli and yang output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#*************************</span>
    <span class="c1"># schema - class variable</span>
    <span class="c1">#</span>
    <span class="c1"># Purpose is to make sure the parser always return the output</span>
    <span class="c1"># (nested dict) that has the same data structure across all supported</span>
    <span class="c1"># parsing mechanisms (cli(), yang(), xml()).</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;show ip interface brief&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parsing mechanism: cli</span>

<span class="sd">        Function cli() defines the cli type output parsing mechanism which</span>
<span class="sd">        typically contains 3 steps: exe</span>
<span class="sd">        cuting, transforming, returning</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">parsergen</span><span class="o">.</span><span class="n">oper_fill_tabular</span><span class="p">(</span><span class="n">device_output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
                                              <span class="n">device_os</span><span class="o">=</span><span class="s1">&#39;iosxe&#39;</span><span class="p">,</span>
                                              <span class="n">table_terminal_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^\n&quot;</span><span class="p">,</span>
                                              <span class="n">header_fields</span><span class="o">=</span>
                                               <span class="p">[</span> <span class="s2">&quot;Interface&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;IP-Address&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;OK\?&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;Method&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;Protocol&quot;</span> <span class="p">],</span>
                                              <span class="n">label_fields</span><span class="o">=</span>
                                               <span class="p">[</span> <span class="s2">&quot;Interface&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;ip_address&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;interface_is_ok&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;method&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;status&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;protocol&quot;</span> <span class="p">],</span>
                                              <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Building the schema out o fthe parsergen output</span>
            <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">res</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">intf</span><span class="p">][</span><span class="s1">&#39;Interface&#39;</span><span class="p">]</span>

                <span class="n">parsed_dict</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">entries</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">parsed_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">yang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; parsing mechanism: yang</span>

<span class="sd">        Function yang() defines the yang type output parsing mechanism which</span>
<span class="sd">        typically contains 3 steps: executing, transforming, returning</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">yang_cli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cli_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli</span><span class="p">()</span>
        <span class="n">yang_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yang</span><span class="p">()</span>
        <span class="n">merged_output</span> <span class="o">=</span> <span class="n">_merge_dict</span><span class="p">(</span><span class="n">yang_output</span><span class="p">,</span><span class="n">cli_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged_output</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For package advanced usage, you can refer to <a class="reference internal" href="advanced/introduction.html#advanced-usage"><span class="std std-ref">Advanced Usage</span></a> section.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="advanced/index.html" class="btn btn-neutral float-right" title="Advanced" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Metaparsers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Cisco Systems Inc.
      <span class="lastupdated">
        Last updated on Dec 22, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>