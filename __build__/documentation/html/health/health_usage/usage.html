

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Genie Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/asciinema-player.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/genie_ico.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/asciinema-player.js"></script>
        <script src="../../_static/tracker.js"></script>
        <script src="../../_static/embed_version.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Genie Command Line" href="../../cli/index.html" />
    <link rel="prev" title="Design" href="../health_design/design.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> pyATS Library: Genie
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbooks/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../userguide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../clean/index.html">pyATS Clean</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">pyATS Health Check</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../health_installation/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../health_design/design.html">Design</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrated">Integrated</a></li>
<li class="toctree-l3"><a class="reference internal" href="#standalone">Standalone</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pyats-health-check-yaml-validation">pyATS Health Check YAML Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pyats-health-check-examples">pyATS Health Check Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cli/index.html">Genie Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solutions/index.html">Genie Solutions</a></li>
</ul>
<p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">Available APIs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/clean">Available Clean Stages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/models">Available Models (Conf/Ops)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">Available Parsers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/triggers">Available Triggers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/verifications">Available Verifications</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../abstract/index.html">Library Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metaparser/index.html">Metaparsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parsergen/index.html">CLI Auto-Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../predcore/index.html">Predicates</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap/index.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyATS Library: Genie</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">pyATS Health Check</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>This page contains all the documentation needed to use <code class="xref py py-obj docutils literal notranslate"><span class="pre">pyATS</span> <span class="pre">Health</span> <span class="pre">Check</span></code>.
Currently, <code class="xref py py-obj docutils literal notranslate"><span class="pre">pyATS</span> <span class="pre">Health</span> <span class="pre">Check</span></code> is only supported via integrated mode (run via pyATS job). <code class="xref py py-obj docutils literal notranslate"><span class="pre">Standalone</span></code> mode and more are coming in a future release!</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>sourced pyATS virtual environment</p></li>
<li><p>testbed yaml</p></li>
<li><p>health yaml</p></li>
</ul>
</div>
<div class="section" id="integrated">
<h2>Integrated<a class="headerlink" href="#integrated" title="Permalink to this headline">¶</a></h2>
<p>Running <code class="xref py py-obj docutils literal notranslate"><span class="pre">pyATS</span> <span class="pre">Health</span> <span class="pre">Check</span></code> integrated with pyATS scripts is the way if a user wants to collect and monitor device status on a testbed through a pyATS job.</p>
<p>Once you have both the testbed yaml and health yaml then run this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyats</span> <span class="n">run</span> <span class="n">job</span> <span class="o">&lt;</span><span class="n">job</span> <span class="n">file</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">testbed</span><span class="o">-</span><span class="n">file</span> <span class="o">&lt;</span><span class="n">testbed</span> <span class="n">file</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">health</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="standalone">
<h2>Standalone<a class="headerlink" href="#standalone" title="Permalink to this headline">¶</a></h2>
<p>Coming in a future release.</p>
</div>
<div class="section" id="pyats-health-check-yaml-validation">
<h2>pyATS Health Check YAML Validation<a class="headerlink" href="#pyats-health-check-yaml-validation" title="Permalink to this headline">¶</a></h2>
<p>To validate</p>
<p>Once you have a pyats health check yaml then run this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyats</span> <span class="n">validate</span> <span class="n">datafile</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">health</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="pyats-health-check-examples">
<h2>pyATS Health Check Examples<a class="headerlink" href="#pyats-health-check-examples" title="Permalink to this headline">¶</a></h2>
<p>pyATS Health Check examples can be found in our <a class="reference external" href="https://github.com/CiscoTestAutomation/examples/tree/master/health">Github repo</a>.</p>
<p>Here is how to leverage those example for your case.
Let’s look at <a class="reference external" href="https://github.com/CiscoTestAutomation/examples/tree/master/health/cpu_memory_average">cpu/memory average check</a>.</p>
<p>This example will check CPU load and Memory usage for BGP processes. If multiple processes are hit by regex <code class="xref py py-obj docutils literal notranslate"><span class="pre">BGP.*</span></code>. The result value will be returned as average. (This behavior depends on which API is used)</p>
<p>All the examples has device <code class="xref py py-obj docutils literal notranslate"><span class="pre">uut</span></code> or something else. To use these examples for your device, what you need to do is to change device name to yours. Device name or alias in testbed yaml needs to be given to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">device</span></code>.</p>
<p>And for <code class="xref py py-obj docutils literal notranslate"><span class="pre">memory</span></code> section, added <code class="xref py py-obj docutils literal notranslate"><span class="pre">OSPF.*</span></code> regex to select OSPF related processes addition to BGP ones. Based on API arguments, contents of pyATS Health Check are very customizable/flexible.</p>
<p>Most of Blitz actions support <code class="xref py py-obj docutils literal notranslate"><span class="pre">include</span></code>/<code class="xref py py-obj docutils literal notranslate"><span class="pre">exclude</span></code> to indicate what the criteria is for the action. In below case, <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;=</span> <span class="pre">90</span></code> means that returned value from API is expected to be 90% or less.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pyats_health_processors</span><span class="p">:</span>
  <span class="nt">source</span><span class="p">:</span>
    <span class="nt">pkg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">genie.libs.health</span>
    <span class="nt">class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">health.Health</span>
  <span class="nt">test_sections</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">cpu</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">api</span><span class="p">:</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASR1K-1</span> <span class="c1"># &lt;&lt;&lt; changed from `uut`</span>
            <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">get_platform_cpu_load</span>
            <span class="nt">arguments</span><span class="p">:</span>
              <span class="nt">processes</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;BGP.*&#39;</span><span class="p p-Indicator">]</span>
            <span class="nt">include</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="s">&quot;&lt;=</span><span class="nv"> </span><span class="s">90&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">memory</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">api</span><span class="p">:</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASR1K-1</span> <span class="c1"># &lt;&lt;&lt; changed from `uut`</span>
            <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">get_platform_memory_usage</span>
            <span class="nt">arguments</span><span class="p">:</span>
              <span class="nt">processes</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;BGP.*&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;OSPF.*&#39;</span><span class="p p-Indicator">]</span>
            <span class="nt">include</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="s">&quot;&lt;=</span><span class="nv"> </span><span class="s">90&quot;</span>
</pre></div>
</div>
<p>By default, pyATS Health Check will run these health checks every testcase/section. You might want to narrow down where pyATS Health Check runs. For example, above example is checking BGP processes CPU/Memory. So, let’s narrow down to run only for related testcases/section.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pyats_health_processors</span><span class="p">:</span>
  <span class="nt">source</span><span class="p">:</span>
    <span class="nt">pkg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">genie.libs.health</span>
    <span class="nt">class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">health.Health</span>
  <span class="nt">test_sections</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">cpu</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">api</span><span class="p">:</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASR1K-1</span>
            <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">get_platform_cpu_load</span>
            <span class="nt">arguments</span><span class="p">:</span>
              <span class="nt">processes</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;BGP.*&#39;</span><span class="p p-Indicator">]</span>
            <span class="nt">include</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="s">&quot;&lt;=</span><span class="nv"> </span><span class="s">90&quot;</span>
            <span class="nt">health_groups</span><span class="p">:</span> <span class="s">&#39;.*bgp.*&#39;</span> <span class="c1"># &lt;&lt;&lt; use regex to match any BGP processes</span>
    <span class="p p-Indicator">-</span> <span class="nt">memory</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">api</span><span class="p">:</span>
            <span class="nt">device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ASR1K-1</span> <span class="c1"># &lt;&lt;&lt; changed from `uut`</span>
            <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">get_platform_memory_usage</span>
            <span class="nt">arguments</span><span class="p">:</span>
              <span class="nt">processes</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;BGP.*&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;OSPF.*&#39;</span><span class="p p-Indicator">]</span>
            <span class="nt">include</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="s">&quot;&lt;=</span><span class="nv"> </span><span class="s">90&quot;</span>
            <span class="nt">health_sections</span><span class="p">:</span> <span class="s">&#39;bgp_full_route_check&#39;</span> <span class="c1"># &lt;&lt;&lt; specify exact section name</span>
</pre></div>
</div>
<p>For <code class="xref py py-obj docutils literal notranslate"><span class="pre">cpu</span></code> action, <code class="xref py py-obj docutils literal notranslate"><span class="pre">health_groups:</span> <span class="pre">'.*bgp.*'</span></code> is given to run the action only for testcases which the regex <code class="xref py py-obj docutils literal notranslate"><span class="pre">*bgp.*</span></code> match its group.
For <code class="xref py py-obj docutils literal notranslate"><span class="pre">memory</span></code> action, <code class="xref py py-obj docutils literal notranslate"><span class="pre">health_sections:</span> <span class="pre">'bgp_full_route_check'</span></code> is given. Exact section name without regex is provided, so the <code class="xref py py-obj docutils literal notranslate"><span class="pre">memory</span></code> action will run only for the exact same section name but effective for all the testcases. Please check for the detail of pyATS Health Check arguments <code class="xref py py-obj docutils literal notranslate"><span class="pre">health_uids</span></code>/<code class="xref py py-obj docutils literal notranslate"><span class="pre">health_groups</span></code>/<code class="xref py py-obj docutils literal notranslate"><span class="pre">health_sections</span></code> from <a class="reference internal" href="../health_design/design.html#select-testcase-section"><span class="std std-ref">Selecting Testcase/Section</span></a></p>
<p>pyATS Health Check is very flexible because you can leverage any features in Blitz. You can create your own Health Check by using any of the Blitz feature, give it a try! <a class="reference external" href="https://pubhub.devnetcloud.com/media/pyats-development-guide/docs/writeblitz/writeblitz.html">Quick Trigger (Blitz)</a>.</p>
<p>The examples repo is open-sourced. Any contributions for pyATS Health Check examples are encouraged!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../cli/index.html" class="btn btn-neutral float-right" title="Genie Command Line" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../health_design/design.html" class="btn btn-neutral float-left" title="Design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Cisco Systems Inc.
      <span class="lastupdated">
        Last updated on Dec 22, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>