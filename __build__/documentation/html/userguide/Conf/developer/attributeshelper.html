

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Attributes helper &mdash; Genie Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/asciinema-player.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/genie_ico.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/asciinema-player.js"></script>
        <script src="../../../_static/tracker.js"></script>
        <script src="../../../_static/embed_version.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Cli Config Builder" href="clibuilder.html" />
    <link rel="prev" title="First Steps" href="basicfeature.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> pyATS Library: Genie
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbooks/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Conf Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../user/index.html">Conf User Guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Conf Developer Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="basicfeature.html">First Steps</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Attributes helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="clibuilder.html">Cli Config Builder</a></li>
<li class="toctree-l4"><a class="reference internal" href="managedattribute.html">Managed Attribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="abstraction.html">Abstraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="final.html">Final Version</a></li>
<li class="toctree-l4"><a class="reference internal" href="uml.html">UML</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Ops/index.html">Ops Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../harness/index.html">Harness Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../robot/index.html">RobotFramework Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../genietelemetry/integration.html">GenieTelemetry Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apis/index.html">API Guidelines and good practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utils/index.html">Useful Libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../clean/index.html">pyATS Clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../health/index.html">pyATS Health Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/index.html">Genie Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../solutions/index.html">Genie Solutions</a></li>
</ul>
<p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">Available APIs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/clean">Available Clean Stages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/models">Available Models (Conf/Ops)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">Available Parsers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/triggers">Available Triggers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/verifications">Available Verifications</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../abstract/index.html">Library Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../metaparser/index.html">Metaparsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parsergen/index.html">CLI Auto-Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../predcore/index.html">Predicates</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap/index.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyATS Library: Genie</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">User Guide</a> &raquo;</li>
        
          <li><a href="../index.html">Conf Guide</a> &raquo;</li>
        
          <li><a href="index.html">Conf Developer Guide</a> &raquo;</li>
        
      <li>Attributes helper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="attributes-helper">
<span id="attribute-helper"></span><h1>Attributes helper<a class="headerlink" href="#attributes-helper" title="Permalink to this headline">¶</a></h1>
<p>This section continues the evolution of our <code class="docutils literal notranslate"><span class="pre">Genie</span></code> configurable object,
and add <code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code> which make the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Feature</span></code> objects much more
powerful.</p>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code> replaces the boilerplate coding requirement for each
<code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> to deal with the attributes. It also takes care of requirement 1 and
2 from the previous section.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Attributes of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Feature</span></code> drive the configuration, unless argument
<code class="xref py py-obj docutils literal notranslate"><span class="pre">attributes</span></code> is passed to the method. Then <code class="xref py py-obj docutils literal notranslate"><span class="pre">attributes</span></code> control what get
configured.</p></li>
<li><p>The same <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> object can be associated with multiple objects, such as
device, address families, this association allows any attributes set at the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code>, or any level, to also propagate to the object the <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> were
associated with.</p></li>
</ol>
</div></blockquote>
<p>The next example shows that <code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code> can do everything that was
possible in the previous section, while removing some extra code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Imports ####</span>
<span class="kn">from</span> <span class="nn">genie.conf</span> <span class="kn">import</span> <span class="n">Genie</span>
<span class="kn">from</span> <span class="nn">genie.conf.base</span> <span class="kn">import</span> <span class="n">Device</span>
<span class="kn">from</span> <span class="nn">genie.conf.base</span> <span class="kn">import</span> <span class="n">Testbed</span>
<span class="kn">from</span> <span class="nn">genie.conf.base.base</span> <span class="kn">import</span> <span class="n">DeviceFeature</span>
<span class="kn">from</span> <span class="nn">genie.conf.base.attributes</span> <span class="kn">import</span> <span class="n">AttributesHelper</span>

<span class="c1">#### Vrf class ####</span>
<span class="k">class</span> <span class="nc">Vrf</span><span class="p">(</span><span class="n">DeviceFeature</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Allow to pass a list of Devices,</span>
        <span class="c1"># then only those devices will be configured</span>
        <span class="c1"># Requirement 4</span>
        <span class="k">if</span> <span class="n">devices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="c1"># New attribute helper</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">AttributesHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Make sure we remove duplicate device (in case)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>
        <span class="c1"># Hold the configuration for each device in a separate key of the</span>
        <span class="c1"># dictionary.</span>
        <span class="n">cfgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="c1"># List containing configuration for this loop</span>
            <span class="c1"># will be added to cfg</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Configure vrf on the device</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vrf </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)))</span>
            <span class="c1"># Requirement 1</span>
            <span class="c1"># Let the configurable_attributes drive the configuration</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">):</span>
                <span class="c1"># Configure description on the device</span>
                <span class="c1"># with an indendation for the config</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; description </span><span class="si">{description}</span><span class="s1">&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;rd&#39;</span><span class="p">):</span>
                <span class="c1"># Configure rd on the device</span>
                <span class="c1"># with an indendation for the config</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; rd </span><span class="si">{rd}</span><span class="s1">&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="n">rd</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;rd&#39;</span><span class="p">)))</span>
            <span class="n">cfgs</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="c1"># Requirement 3</span>
        <span class="k">if</span> <span class="n">apply</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cfgs</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                    <span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">cfgs</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cfgs</span>

<span class="c1">#### Main section ####</span>
<span class="c1"># Set Genie Tb</span>
<span class="n">testbed</span> <span class="o">=</span> <span class="n">Testbed</span><span class="p">()</span>
<span class="n">Genie</span><span class="o">.</span><span class="n">testbed</span> <span class="o">=</span> <span class="n">testbed</span>
<span class="n">dev1</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pe1&#39;</span><span class="p">,</span> <span class="n">testbed</span><span class="o">=</span><span class="n">testbed</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;nxos&#39;</span><span class="p">)</span>
<span class="n">vrf1</span> <span class="o">=</span> <span class="n">Vrf</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vrf1</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="p">[</span><span class="n">dev1</span><span class="p">],</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="c1"># {&#39;pe1&#39;: [&#39;vrf blue&#39;]}</span>

<span class="c1"># Let&#39;s add a description</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;blue_vrf&#39;</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">rd</span> <span class="o">=</span> <span class="s1">&#39;800:1&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vrf1</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="p">[</span><span class="n">dev1</span><span class="p">],</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="c1"># {&#39;pe1&#39;: [&#39;vrf blue&#39;, &#39; description blue_vrf&#39;, &#39; rd 800:1&#39;]}</span>
</pre></div>
</div>
<p>The above code is similar as the previous example with some logic was removed,
we’ve kept what we had so far.  Let’s now tackle our the second half of the
first requirement (in bold) with our new <code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code>.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Attributes of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Feature</span></code> drive the configuration, <strong>unless argument
`attributes` is passed to the method. Then `attributes` control what get
configured.</strong></p></li>
</ol>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Imports ####</span>
<span class="kn">from</span> <span class="nn">genie.conf</span> <span class="kn">import</span> <span class="n">Genie</span>
<span class="kn">from</span> <span class="nn">genie.conf.base</span> <span class="kn">import</span> <span class="n">Device</span>
<span class="kn">from</span> <span class="nn">genie.conf.base</span> <span class="kn">import</span> <span class="n">Testbed</span>
<span class="kn">from</span> <span class="nn">genie.conf.base.base</span> <span class="kn">import</span> <span class="n">DeviceFeature</span>
<span class="kn">from</span> <span class="nn">genie.conf.base.attributes</span> <span class="kn">import</span> <span class="n">AttributesHelper</span>

<span class="c1">#### Vrf class ####</span>
<span class="k">class</span> <span class="nc">Vrf</span><span class="p">(</span><span class="n">DeviceFeature</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Allow to pass a list of Devices,</span>
        <span class="c1"># then only those devices will be configured</span>
        <span class="c1"># Requirement 4</span>
        <span class="k">if</span> <span class="n">devices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="c1"># New attribute helper</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">AttributesHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="c1"># Make sure we remove duplicate device (in case)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>
        <span class="c1"># Hold the configuration for each device in a separate key of the</span>
        <span class="c1"># dictionary.</span>
        <span class="n">cfgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="c1"># List containing configuration for this loop</span>
            <span class="c1"># will be added to cfg</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Configure vrf on the device</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vrf </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)))</span>
            <span class="c1"># Requirement 1</span>
            <span class="c1"># Let the configurable_attributes drive the configuration</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">):</span>
                <span class="c1"># Configure description on the device</span>
                <span class="c1"># with an indendation for the config</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; description </span><span class="si">{description}</span><span class="s1">&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;rd&#39;</span><span class="p">):</span>
                <span class="c1"># Configure rd on the device</span>
                <span class="c1"># with an indendation for the config</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; rd </span><span class="si">{rd}</span><span class="s1">&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="n">rd</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;rd&#39;</span><span class="p">)))</span>
            <span class="n">cfgs</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="c1"># Requirement 3</span>
        <span class="k">if</span> <span class="n">apply</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cfgs</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                    <span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">cfgs</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cfgs</span>

<span class="c1">#### Main section ####</span>
<span class="c1"># Set Genie Tb</span>
<span class="n">testbed</span> <span class="o">=</span> <span class="n">Testbed</span><span class="p">()</span>
<span class="n">Genie</span><span class="o">.</span><span class="n">testbed</span> <span class="o">=</span> <span class="n">testbed</span>
<span class="n">dev1</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pe1&#39;</span><span class="p">,</span> <span class="n">testbed</span><span class="o">=</span><span class="n">testbed</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;nxos&#39;</span><span class="p">)</span>
<span class="n">vrf1</span> <span class="o">=</span> <span class="n">Vrf</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;blue_vrf&#39;</span><span class="p">,</span> <span class="n">rd</span><span class="o">=</span><span class="s1">&#39;800:1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vrf1</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="p">[</span><span class="n">dev1</span><span class="p">],</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="c1"># {&#39;pe1&#39;: [&#39;vrf blue&#39;, &#39; description blue_vrf&#39;, &#39; rd 800:1&#39;]}</span>

<span class="c1"># let&#39;s modify the description and re-apply only this section</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;blue_vrf_ver2&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vrf1</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="p">[</span><span class="n">dev1</span><span class="p">],</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}))</span>
<span class="c1"># {&#39;pe1&#39;: [&#39;vrf blue&#39;, &#39; description blue_vrf_ver2&#39;]}</span>
</pre></div>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelpers</span></code> does all the heavy work for us, all it took was adding one
argument to it and using it with <code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">AttributesHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</pre></div>
</div>
<p>We’ve added an argument named <code class="xref py py-obj docutils literal notranslate"><span class="pre">attributes</span></code>, and passed it to
<code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code>. In the above example, description was modified, and only
this specific section was re-configured for this particular vrf.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>More to come… I recommend to go get some MORE coffee and take a break…
(I know I needed it in order to write on)</p>
</div>
</div>
<div class="section" id="keyedsubattributes-and-subattributes">
<span id="subattributes"></span><h2>KeyedSubAttributes and SubAttributes<a class="headerlink" href="#keyedsubattributes-and-subattributes" title="Permalink to this headline">¶</a></h2>
<p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Feature</span></code> in a <code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code> is configured following a certain level of
hierarchy, mandating the attributes to be set in a certain fashion. Thus a
hierarchy of attributes is required. For example, some configuration is only
available when other configuration is present or when inside other block
of configuration.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>router rip1
 address-family ipv4 unicast
  default-metric 1
</pre></div>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">address-family</span> <span class="pre">ipv4</span> <span class="pre">unicast</span></code> is only available inside <code class="xref py py-obj docutils literal notranslate"><span class="pre">router</span> <span class="pre">rip1</span></code>.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">default-metric</span> <span class="pre">1</span></code> is only available inside <code class="xref py py-obj docutils literal notranslate"><span class="pre">address-family</span> <span class="pre">ipv4</span> <span class="pre">unicast</span></code>.</p>
<p>This is what requirement 2 is all about.</p>
<blockquote>
<div><ol class="arabic simple" start="2">
<li><p>The same <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> object can be associated with multiple objects, such as
device, address families, this association allows any attributes set at the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code>, or any level, to also propagate to the object the <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> were
associated with.</p></li>
</ol>
</div></blockquote>
<p>Let’s take the following configuration that we want on two devices.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PE1
 vrf Blue
  description PE1_blue_vrf
  rd 800:1
  address familly ipv4
   route-target import 1:1
  address familly ipv6
   route-target import 1:2

PE2
 vrf Blue
  description PE2_blue_vrf
  rd 800:1
  address familly ipv4
   route-target import 1:1
  address familly ipv6
   route-target import 1:2
</pre></div>
</div>
<p>Let’s list the requirements.</p>
<ul class="simple">
<li><p>Vrf Blue on both <code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code></p></li>
<li><p>Different description on both device</p></li>
<li><p>Same RD for both device</p></li>
<li><p>Ipv4 and ipv6 configuration on both device</p></li>
<li><p>A different ip address for each address familly and for each device</p></li>
</ul>
<p>The idea to solve this is quite intuitive. Let’s have a dictionary, where the
key represents a <strong>unique identifier</strong>, and the value is <strong>another object</strong>
holding the attributes for this object.</p>
<p>For example, the <strong>unique identifier</strong> could be the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code> object, containing
a an <code class="xref py py-obj docutils literal notranslate"><span class="pre">device_attr</span></code> object. Then this <code class="xref py py-obj docutils literal notranslate"><span class="pre">device_attr</span></code> contains another dictionary
with <code class="xref py py-obj docutils literal notranslate"><span class="pre">ipv4</span></code> key.</p>
<p>You can find below the structure that the object needs to hold to keep
all the information of the configuration.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Object structure
VRF Feature
 rd 800:1
 PE1
  description PE1_blue_vrf
  ipv4
   route-target import 1:1
  ipv6
   route-target import 1:2

 PE2
  description PE2_blue_vrf
  ipv4
   route-target import 1:1
  ipv6
   route-target import 1:2
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># How to use it</span>
<span class="n">vrf1</span> <span class="o">=</span> <span class="n">Vrf</span><span class="p">()</span>
<span class="c1"># Attributes which is similar for all Vrf can be set at this level</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">rd</span> <span class="o">=</span> <span class="s1">&#39;800:1&#39;</span>

<span class="c1"># Dev1 Device attributes</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;PE1_blue_vrf&#39;</span>
<span class="c1"># Dev1 Ipv4 attributes</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">address_family</span><span class="p">[</span><span class="s1">&#39;ipv4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">route_target</span> <span class="o">=</span> <span class="s1">&#39;1:1&#39;</span>
<span class="c1"># Dev1 Ipv6 attributes</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">address_family</span><span class="p">[</span><span class="s1">&#39;ipv6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;1:2&#39;</span>

<span class="c1"># Dev2 Device attributes</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev2</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;PE2_blue vrf&#39;</span>
<span class="c1"># Dev2 Ipv4 attributes</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev2</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">address_family</span><span class="p">[</span><span class="s1">&#39;ipv4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">route_target</span> <span class="o">=</span><span class="s1">&#39;1:1&#39;</span>
<span class="c1"># Dev2 Ipv6 attributes</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev2</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">address_family</span><span class="p">[</span><span class="s1">&#39;ipv6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">route_target</span> <span class="o">=</span> <span class="s1">&#39;1:2&#39;</span>
</pre></div>
</div>
<p>In the above example, we needed some object to hold these block of
attributes, we also needed a dictionary and a mechanism to propagate attributes
to children level. <code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyedSubAttributes</span></code> represent those objects, and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyedSubAttributes</span></code> is the dictionary that ties everything together.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyedSubAttributes</span></code> is a base class to hold the <code class="xref py py-obj docutils literal notranslate"><span class="pre">blocks</span></code> of the above section.
This base class should be inherited and your own implementation should be
created from it. Inside the infrastructure of <code class="docutils literal notranslate"><span class="pre">Genie</span></code> we are also providing
two <code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyedSubAttributes</span></code> for script usage, <code class="xref py py-obj docutils literal notranslate"><span class="pre">DeviceSubAttributes</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">InterfaceSubAttributes</span></code>. An example of using <code class="xref py py-obj docutils literal notranslate"><span class="pre">DeviceSubAttributes</span></code> can be found
below.</p>
<p>The next question is how do we all tie this back to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> ?
<code class="xref py py-obj docutils literal notranslate"><span class="pre">SubAttributesDict</span></code> comes to the rescue! It is a special dictionary that holds
multiple <code class="xref py py-obj docutils literal notranslate"><span class="pre">blocks</span></code> of object. It basically works like this; when a key is
requested, it verify if it exists, if it does it returns the value, otherwise
it instantiate an object inherited from <code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyedSubAttributes</span></code> and stores it as a
value of this key. <code class="xref py py-obj docutils literal notranslate"><span class="pre">SubAttributesDict</span></code> has a few more powers, but let’s focus
on the base and the most important idea for now.</p>
<p>Let’s jump into an example to demonstrate how all of these new concepts work.
We will modify our previous example to support configuration for multiple
<code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code> in the same <code class="xref py py-obj docutils literal notranslate"><span class="pre">Feature</span></code>.</p>
<p>Here are the changes that are needed :</p>
<ul class="simple">
<li><p>Import <code class="xref py py-obj docutils literal notranslate"><span class="pre">DeviceSubAttributes</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">SubAttributesDict</span></code></p></li>
<li><p>Create a new DeviceAttributes Class which inherits from <code class="xref py py-obj docutils literal notranslate"><span class="pre">DeviceSubAttributes</span></code></p></li>
<li><p>Add to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Vrf</span></code> <code class="xref py py-obj docutils literal notranslate"><span class="pre">SubAttributesDict</span></code></p></li>
<li><p>Add <code class="xref py py-obj docutils literal notranslate"><span class="pre">build_config</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">build_unconfig</span></code> to loop each <code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code> to configure.</p></li>
<li><p>To loop over each <code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">attributes.mapping_items</span></code> is used. It’s a new
from <code class="xref py py-obj docutils literal notranslate"><span class="pre">AttributesHelper</span></code>, which allow to loop over the dictionary and has a
few extra functionality.</p></li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>All code in those examples are executable. This allows you to play
with the code as you read. When the code is too long to be
posted on the website, a download location is provided.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>To execute those example, source your virtual environment,
type python, and paste the code in there.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Imports ####</span>
<span class="kn">from</span> <span class="nn">genie.conf</span> <span class="kn">import</span> <span class="n">Genie</span>
<span class="kn">from</span> <span class="nn">genie.conf.base</span> <span class="kn">import</span> <span class="n">Device</span>
<span class="kn">from</span> <span class="nn">genie.conf.base</span> <span class="kn">import</span> <span class="n">Testbed</span>
<span class="kn">from</span> <span class="nn">genie.conf.base.attributes</span> <span class="kn">import</span> <span class="n">DeviceSubAttributes</span><span class="p">,</span>\
                                       <span class="n">SubAttributesDict</span><span class="p">,</span>\
                                       <span class="n">AttributesHelper</span>
<span class="kn">from</span> <span class="nn">genie.conf.base.base</span> <span class="kn">import</span> <span class="n">DeviceFeature</span>

<span class="c1">#### Vrf class ####</span>
<span class="k">class</span> <span class="nc">Vrf</span><span class="p">(</span><span class="n">DeviceFeature</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">DeviceAttributes</span><span class="p">(</span><span class="n">DeviceSubAttributes</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="c1"># List containing configuration for this loop</span>
            <span class="c1"># will be added to cfgs</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Configure vrf on the device</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vrf </span><span class="si">{name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="c1"># Requirement 1</span>
            <span class="c1"># Let the configurable_attributes drive the configuration</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">):</span>
                <span class="c1"># Configure description on the device</span>
                <span class="c1"># with an indendation for the config</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; description </span><span class="si">{description}</span><span class="s1">&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;rd&#39;</span><span class="p">):</span>
                <span class="c1"># Configure rd on the device</span>
                <span class="c1"># with an indendation for the config</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; rd </span><span class="si">{rd}</span><span class="s1">&#39;</span><span class="o">.</span>
                            <span class="nb">format</span><span class="p">(</span><span class="n">rd</span><span class="o">=</span><span class="n">attributes</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;rd&#39;</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">cfg</span>
    <span class="c1"># __init__ of Vrf</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_attr</span> <span class="o">=</span> <span class="n">SubAttributesDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DeviceAttributes</span><span class="p">,</span>
                                             <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Adding a new build_config, to call</span>
    <span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cfgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">AttributesHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">devices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="c1">#devices = set(dev.name for dev in devices)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>
        <span class="c1"># Loop over all the items of &#39;self.device_attr&#39;, sort them,</span>
        <span class="c1"># and only care about the keys which are in keys.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">attributes2</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">mapping_items</span><span class="p">(</span>
                <span class="s1">&#39;device_attr&#39;</span><span class="p">,</span>
                <span class="n">keys</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># For each, call their build_config with attributes as an argument.</span>
            <span class="c1"># attributes2 is only the attributes related to this particular</span>
            <span class="c1"># device, and its parent attributes. (To allow parent default</span>
            <span class="c1"># values)</span>
            <span class="n">cfgs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">apply</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cfgs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">devices_map</span><span class="p">[</span><span class="n">device_name</span><span class="p">]</span>
                    <span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cfgs</span>

<span class="c1">#### Main section ####</span>
<span class="c1"># Set Genie Tb</span>
<span class="kn">from</span> <span class="nn">genie.conf</span> <span class="kn">import</span> <span class="n">Genie</span>
<span class="n">testbed</span> <span class="o">=</span> <span class="n">Testbed</span><span class="p">()</span>
<span class="n">Genie</span><span class="o">.</span><span class="n">testbed</span> <span class="o">=</span> <span class="n">Testbed</span><span class="p">()</span>
<span class="n">dev1</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pe1&#39;</span><span class="p">,</span> <span class="n">testbed</span><span class="o">=</span><span class="n">testbed</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;nxos&#39;</span><span class="p">)</span>
<span class="n">dev2</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pe2&#39;</span><span class="p">,</span> <span class="n">testbed</span><span class="o">=</span><span class="n">testbed</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;nxos&#39;</span><span class="p">)</span>
<span class="n">vrf1</span> <span class="o">=</span> <span class="n">Vrf</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vrf1</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="p">[</span><span class="n">dev1</span><span class="p">,</span> <span class="n">dev2</span><span class="p">],</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="c1"># {&#39;pe1&#39;: [&#39;vrf blue&#39;],</span>
<span class="c1">#  &#39;pe2&#39;: [&#39;vrf blue&#39;]}</span>

<span class="c1"># Let&#39;s add a different description for both device</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev1</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;PE1_blue_vrf&#39;</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">device_attr</span><span class="p">[</span><span class="n">dev2</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;PE2_blue_vrf&#39;</span>
<span class="c1"># And same RD for both, we can set it at the parent level as we want it</span>
<span class="c1"># to be of the same value</span>
<span class="n">vrf1</span><span class="o">.</span><span class="n">rd</span> <span class="o">=</span> <span class="s1">&#39;800:1&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vrf1</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="p">[</span><span class="n">dev1</span><span class="p">,</span> <span class="n">dev2</span><span class="p">],</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="c1"># {&#39;pe1&#39;: [&#39;vrf blue&#39;, &#39; description PE1_blue_vrf&#39;, &#39; rd 800:1&#39;],</span>
<span class="c1">#  &#39;pe2&#39;: [&#39;vrf blue&#39;, &#39; description PE2_blue_vrf&#39;, &#39; rd 800:1&#39;]}</span>
</pre></div>
</div>
<p>All the above concepts scale, and can create many levels of structure. For
example, we could’ve put <code class="xref py py-obj docutils literal notranslate"><span class="pre">AdressFamilyAttributes</span></code> as another level in our <code class="xref py py-obj docutils literal notranslate"><span class="pre">Vrf</span></code>
example , which would have been placed under <code class="xref py py-obj docutils literal notranslate"><span class="pre">DeviceAttributes</span></code>.</p>
<p>In the next section, we will demonstrate how configuration is created in a
scalable fashion.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="clibuilder.html" class="btn btn-neutral float-right" title="Cli Config Builder" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basicfeature.html" class="btn btn-neutral float-left" title="First Steps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Cisco Systems Inc.
      <span class="lastupdated">
        Last updated on Dec 22, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>