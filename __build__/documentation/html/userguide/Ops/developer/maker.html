

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Maker &mdash; Genie Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/asciinema-player.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/genie_ico.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/asciinema-player.js"></script>
        <script src="../../../_static/tracker.js"></script>
        <script src="../../../_static/embed_version.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Abstraction" href="abstraction.html" />
    <link rel="prev" title="Develop Ops" href="ops.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> pyATS Library: Genie
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbooks/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Conf/index.html">Conf Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Ops Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../user/index.html">Ops User Guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Ops Developer Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ops.html">Develop Ops</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Maker</a></li>
<li class="toctree-l4"><a class="reference internal" href="abstraction.html">Abstraction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../harness/index.html">Harness Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../robot/index.html">RobotFramework Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../genietelemetry/integration.html">GenieTelemetry Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apis/index.html">API Guidelines and good practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utils/index.html">Useful Libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../clean/index.html">pyATS Clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../health/index.html">pyATS Health Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/index.html">Genie Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../solutions/index.html">Genie Solutions</a></li>
</ul>
<p class="caption"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/apis">Available APIs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/clean">Available Clean Stages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/models">Available Models (Conf/Ops)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/parsers">Available Parsers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/triggers">Available Triggers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pubhub.devnetcloud.com/media/genie-feature-browser/docs/#/verifications">Available Verifications</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../abstract/index.html">Library Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../metaparser/index.html">Metaparsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parsergen/index.html">CLI Auto-Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../predcore/index.html">Predicates</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap/index.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyATS Library: Genie</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">User Guide</a> &raquo;</li>
        
          <li><a href="../index.html">Ops Guide</a> &raquo;</li>
        
          <li><a href="index.html">Ops Developer Guide</a> &raquo;</li>
        
      <li>Maker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="maker">
<span id="id1"></span><h1>Maker<a class="headerlink" href="#maker" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> simplifies the process of mapping parsers’ output to
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">ops</span></code> object attributes.</p>
<p>To help users understand exactly how <code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> works, let’s begin with an example.
Let’s say we have a parser that returns the following dictionary:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>process_id:
    1
        vrf
            blue
                id:2
                age:3
            orange
                id:5
                age:6
    2
        vrf
            default
                id:12
                age:13
            orange
                id:15
                age:16
</pre></div>
</div>
<p>Although this parser output is good, let’s say we want to rename <code class="xref py py-obj docutils literal notranslate"><span class="pre">id</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">router_id</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;id&gt;
    vrf
        &lt;vrf&gt;
            router_id:&lt;value&gt;
            age:&lt;value&gt;
</pre></div>
</div>
<p>To achieve this, we would likely use the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy dictionary, as we want to modify it, but we cannot modify a dictionary</span>
<span class="c1"># we are looping over</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">dict_tmp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">pid_value</span> <span class="ow">in</span> <span class="n">dict_tmp</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">vrf</span><span class="p">,</span> <span class="n">vrf_value</span> <span class="ow">in</span>  <span class="n">pid_value</span><span class="p">[</span><span class="s1">&#39;vrf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">vrf_value</span><span class="p">:</span>
            <span class="c1"># Got the place, but we cannot modify the dictionary</span>
            <span class="c1"># But we took a copy, so we can modify the output itself with</span>
            <span class="c1"># the keys</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">][</span><span class="n">pid</span><span class="p">][</span><span class="s1">&#39;vrf&#39;</span><span class="p">][</span><span class="n">vrf</span><span class="p">][</span><span class="s1">&#39;router_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vrf_value</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">][</span><span class="n">pid</span><span class="p">][</span><span class="s1">&#39;vrf&#39;</span><span class="p">][</span><span class="n">vrf</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Users would need to rely on this boiler-type code for every name change.</p>
<p>Now, let’s imagine the user also wanted to change the received structure to look like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;vrf&gt;
    process_id
        &lt;id&gt;
            router_id:&lt;value&gt;
            age:&lt;value&gt;
</pre></div>
</div>
<p>This code is repetitive and difficult to maintain. Now, imagine merging two
structured outputs like this into one common structure, this becomes even more redundant
and even more difficult to read than the previous example.</p>
<p>Fortunately, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> overcomes this repetition and redundancy. <code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> can:</p>
<ul class="simple">
<li><p>Rename key names from parser outputs;</p></li>
<li><p>Modify a structure to any new structure; and</p></li>
<li><p>Merge and modify multiple parser outputs into a specific object structure.</p></li>
</ul>
<p>This quick example below shows how easily the previous code can be modified using <code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">genie.ops.base.maker</span> <span class="kn">import</span> <span class="n">Maker</span>

<span class="c1"># Create a class for MyFeature</span>
<span class="k">class</span> <span class="nc">MyFeature</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">learn</span><span class="p">():</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Maker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
                   <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parser</span><span class="o">&gt;</span><span class="p">,</span>
                   <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][age]&#39;</span><span class="p">,</span>
                   <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][age]&#39;</span><span class="p">)</span>

        <span class="c1"># Rename Id to router_id</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
                   <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parser</span><span class="o">&gt;</span><span class="p">,</span>
                   <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][id]&#39;</span><span class="p">,</span>
                   <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][router_id]&#39;</span><span class="p">)</span>

        <span class="n">m</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="n">feature</span> <span class="o">=</span> <span class="n">MyFeature</span><span class="p">()</span>
<span class="n">feature</span><span class="o">.</span><span class="n">learn</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:{</span><span class="s1">&#39;blue&#39;</span><span class="p">:{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="add-leaf">
<h2>add_leaf<a class="headerlink" href="#add-leaf" title="Permalink to this headline">¶</a></h2>
<p>Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">leaf</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> can retrieve the parsed output, navigate the parsed
output, and create the values.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_leaf</span></code> supports the following arguments:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------------------+
| maker.add_leaf                                                           |
+==========================================================================+
| Arguments             | Description                                      |
|-----------------------+--------------------------------------------------|
| device                | Device object                                    |
| cmd                   | Metaparser parser class                          |
| src                   | Path of the values this leaf is interested into  |
| dest                  | Location of where to store it into `parent`      |
| callables             | Map callables strings to callable                |
| action                | Action to take on the output                     |
+==========================================================================+
</pre></div>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">src</span></code> looks into the parsed output for values at a specific location. The output is stored
and then placed at the <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code> location inside the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self</span></code> object.</p>
<p>In short, <code class="xref py py-obj docutils literal notranslate"><span class="pre">src</span></code> is the parser structure and <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code> is the user-defined <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> structure.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">maker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
           <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parsers</span><span class="o">&gt;</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][1][vrf][blue][id]&#39;</span><span class="p">,</span>
           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[1][vrf][blue][router_id]&#39;</span><span class="p">)</span>

<span class="c1"># Can then be retrieve via</span>
<span class="c1"># m.process[&#39;1&#39;][&#39;vrf&#39;][&#39;blue&#39;][&#39;router_id&#39;]</span>
</pre></div>
</div>
<p>This example reads as follows:</p>
<ol class="arabic simple">
<li><p>Look inside the returned parsed output of the parser for <code class="xref py py-obj docutils literal notranslate"><span class="pre">['process_id']['1']['vrf']['blue']['id']</span></code></p></li>
<li><p>Store it inside the <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> object as <code class="xref py py-obj docutils literal notranslate"><span class="pre">['1']['vrf']['blue']['router_id']</span></code></p></li>
<li><p>Which can be retrieved via <code class="xref py py-obj docutils literal notranslate"><span class="pre">parent.process</span></code>, where process is the name given in <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code>.</p></li>
</ol>
<p>However, <code class="xref py py-obj docutils literal notranslate"><span class="pre">1</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">blue</span></code> are hardcoded. We can do better than this, and make it
<strong>dynamic</strong>. We use regex symbolic group name in <code class="xref py py-obj docutils literal notranslate"><span class="pre">src</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code> to generate dynamic value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">maker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
           <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parsers</span><span class="o">&gt;</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][id]&#39;</span><span class="p">,</span>
           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][router_id]&#39;</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,},</span>
               <span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;3&#39;</span><span class="p">}}},</span>
 <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;12&#39;</span><span class="p">,},</span>
               <span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;13&#39;</span><span class="p">}}}}</span>
</pre></div>
</div>
<p>Whenever necessary, users may restructure the <code class="xref py py-obj docutils literal notranslate"><span class="pre">feature</span></code> object so that it is
independent of the parser structure with the regex group name.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
           <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parsers</span><span class="o">&gt;</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;.*)][id]&#39;</span><span class="p">,</span>
           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;vrf[(?P&lt;vrf&gt;.*)][process][(?P&lt;process&gt;.*)][router_id]&#39;</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrf</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;process&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,},</span>
                        <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;13&#39;</span><span class="p">}}},</span>
 <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;process&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,}}},</span>
 <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;process&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;12&#39;</span><span class="p">,}}}}</span>
</pre></div>
</div>
<p>In this example, we changed the entire structure of the dictionary by swapping <code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">process_id</span></code> static keys, and the two regex keys.</p>
<p>Regex follows the following guidelines:</p>
<ol class="arabic simple">
<li><p>A group used in <code class="xref py py-obj docutils literal notranslate"><span class="pre">src</span></code> does not need to be used in <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code>. However, it must
only return one branch of value. <code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> cannot know which branch to return,
nor can it merge it, as some keys could be identical.</p></li>
<li><p>If a group is used in <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code>, it must exist in <code class="xref py py-obj docutils literal notranslate"><span class="pre">src</span></code>.</p></li>
<li><p>If a group is used in <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code> and exists in <code class="xref py py-obj docutils literal notranslate"><span class="pre">src</span></code>, the regex has to be
exactly the same.</p></li>
</ol>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Maker</span></code> also uses the callable function to modify certain keys.
For example, let’s say we want to modify all vrf names in our parser to add a prefix
<code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf-</span></code>, like this <code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf-default</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">maker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
           <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parsers</span><span class="o">&gt;</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;</span><span class="si">{vrf}</span><span class="s1">)][id]&#39;</span><span class="p">,</span>
           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;</span><span class="si">{vrf}</span><span class="s1">)][router_id]&#39;</span><span class="p">,</span>
           <span class="n">callables</span><span class="o">=</span><span class="p">{</span><span class="n">vrf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vrf</span><span class="p">})</span>

<span class="c1"># Lambda are also welcomed, instead of functions :)</span>
<span class="k">def</span> <span class="nf">vrf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="c1"># takes a key as input, and return any other string</span>
    <span class="k">return</span> <span class="s1">&#39;vrf-&#39;</span><span class="o">+</span><span class="n">item</span>

<span class="n">m</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf-blue&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,},</span>
               <span class="s1">&#39;vrf-orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;3&#39;</span><span class="p">}}},</span>
 <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf-default&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;12&#39;</span><span class="p">,},</span>
               <span class="s1">&#39;vrf-orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;13&#39;</span><span class="p">}}}}</span>
</pre></div>
</div>
<p>You can see from the <code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf=self.vrf</span></code>, the keyword <code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf</span></code> matches the regex group
<code class="xref py py-obj docutils literal notranslate"><span class="pre">vrf</span></code> that we wanted to modify. <code class="xref py py-obj docutils literal notranslate"><span class="pre">Callables</span></code> is extremely powerful; it can modify and
transform any key. Instead of setting the <code class="xref py py-obj docutils literal notranslate"><span class="pre">callables</span></code> for each <code class="xref py py-obj docutils literal notranslate"><span class="pre">leaf</span></code>, a global
one can be set. Then all <code class="xref py py-obj docutils literal notranslate"><span class="pre">leafs</span></code> can use this <code class="xref py py-obj docutils literal notranslate"><span class="pre">callables</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">maker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="c1"># Global callable</span>
<span class="bp">self</span><span class="o">.</span><span class="n">callables</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">vrf</span><span class="p">}</span>

<span class="c1"># Then no need to use calables in here</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
           <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parsers</span><span class="o">&gt;</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;</span><span class="si">{vrf}</span><span class="s1">)][id]&#39;</span><span class="p">,</span>
           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[(?P&lt;process&gt;.*)][vrf][(?P&lt;vrf&gt;</span><span class="si">{vrf}</span><span class="s1">)][router_id]&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vrf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="c1"># takes a key as input, and return any other string</span>
    <span class="k">return</span> <span class="s1">&#39;vrf-&#39;</span><span class="o">+</span><span class="n">item</span>

<span class="n">m</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf-blue&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,},</span>
               <span class="s1">&#39;vrf-orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;3&#39;</span><span class="p">}}},</span>
 <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf-default&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span> <span class="s1">&#39;12&#39;</span><span class="p">,},</span>
               <span class="s1">&#39;vrf-orange&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;router_id&#39;</span><span class="p">:</span><span class="s1">&#39;13&#39;</span><span class="p">}}}}</span>
</pre></div>
</div>
<p>Now let’s visit one last argument, <code class="xref py py-obj docutils literal notranslate"><span class="pre">action</span></code>. <code class="xref py py-obj docutils literal notranslate"><span class="pre">action</span></code> allows users to modify the value
which will be stored at the <code class="xref py py-obj docutils literal notranslate"><span class="pre">dest</span></code> location.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">maker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

<span class="c1"># Action function</span>
<span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="n">m</span><span class="o">.</span><span class="n">add_leaf</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
           <span class="n">cmd</span><span class="o">=&lt;</span><span class="n">parsers</span><span class="o">&gt;</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="s1">&#39;[process_id][(?P&lt;process&gt;.*)][vrf]&#39;</span><span class="p">,</span>
           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;process[(?P&lt;process&gt;.*)][vrf],</span>
           <span class="n">action</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span>


<span class="n">m</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">])},</span>
 <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;vrf&#39;</span><span class="p">:</span> <span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">])}}</span>
</pre></div>
</div>
<p>We understand that <code class="xref py py-obj docutils literal notranslate"><span class="pre">callables</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">action</span></code> can be confusing, so let’s make sure their
purpose is clear.</p>
<p><strong>`callables` is an argument to modify a key of the dictionary. `Action` allows
users to modify the output which is stored at the `dest` location.</strong></p>
</div>
<div class="section" id="make">
<h2>make<a class="headerlink" href="#make" title="Permalink to this headline">¶</a></h2>
<p>Api <code class="xref py py-obj docutils literal notranslate"><span class="pre">make</span></code> takes all of the previously created <code class="xref py py-obj docutils literal notranslate"><span class="pre">leafs</span></code>, sends the necessary commands
to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Device</span></code>, and then builds the object from those <code class="xref py py-obj docutils literal notranslate"><span class="pre">leafs</span></code>. If a <span class="xref std std-ref">pool of
device</span> is given to the Ops object, then it will send the
commands in parallel.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="abstraction.html" class="btn btn-neutral float-right" title="Abstraction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ops.html" class="btn btn-neutral float-left" title="Develop Ops" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Cisco Systems Inc.
      <span class="lastupdated">
        Last updated on Dec 22, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>